# 2. 네트워크를 실현하는 기술

## 1. TCP/IP의 기본

### 1-1. TCP/IP **(Transmission Control Protocol/Internet Protocol)**

- **인터넷 프로토콜 스위트**라고도 함
- 서로 다른 컴퓨터 벤더나 운영체제, 회선끼리 통신할 수 있게 하는 통신 프로토콜 세트
- UDP나 ICMP 등 다른 프로토콜도 TCP/IP에 포함됨
- **TCP/IP 4계층 모델**
    
    
    | 계층 | 주요 프로토콜 | 역할 |
    | --- | --- | --- |
    | 4층: 응용 계층 | HTTP, DNS 등 | 애플리케이션에 맞춰서 통신 |
    | 3층: 전송 계층 | TCP, UDP | IP와 애플리케이션을 중새해서 송신된 데이터를 확실하게 전달한다 |
    | 2층: 인터넷 계층 | IP, ICMP, ARP 등 | 네트워크 주소를 기반으로 수신측 컴퓨터까지 데이터를 전송한다 |
    | 1층: 네트워크 접근 계층 | 이더넷, 무선 랜 (Wi-Fi 등) | 컴퓨터를 물리적으로 네트워크에 연결해서 기기 간에 전송할 수 있게 한다. |

### 1-2. OSI 참조 모델

: 컴퓨터가 가져야만 하는 통신 기능을 계층 구조로 나눈 모델, 벤더 간에 상호 통신할 수 있는 네트워크 모델

| OSI 참조 모델 | TCP/IP 4계층 | 주요 프로토콜 |
| --- | --- | --- |
| 7층: 응용 계층
6층: 표현 계층
5층: 세션 계층 | 응용 계층 | HTTP, DNS 등 |
| 4층: 전송 계층 | 전송 계층 | TCP, UDP |
| 3층: 네트워크 계층 | 인터넷 계층 | IP |
| 2층: 데이터 링크 계층
1층: 물리 계층 | 네트워크 접근 계층 | 이더넷 |

### 1-3. 주소(address)

: 통신 상대를 특정하는 식별 정보

- **IP 주소**
    
    : TCP/IP에서 컴퓨터를 식별하기 위해 할당되는 번호
    
    - 컴퓨터 외에 서버, 라우터, 스위치 등과 같은 네트워크 장비에도 IP 주소 할당
    - **프라이빗 IP 주소**: 랜 내부에서 사용
    - **글로벌 IP 주소**: 인터넷에서 사용
- **MAC 주소**
    
    : 네트워크 기기에 처음부터 할당된 번호
    
    - IP 주소와 MAC주소를 조합하여 컴퓨터끼리 통신
    - **MAC 주소**: 이더넷에서 하드웨어끼리 통신 상대를 특정하기 위해 사용
    - **IP 주소**: TCP/IP에서 통신 상대를 특정하고자 IP주소 사용
- **주소를 이용한 통신 흐름과 ARP**
    - **같은 네트워크에 속한 컴퓨터끼리의 통신**
        1. IP 패킷을 보내고 싶은 상대의 MAC 주소를 조사 (**ARP 사용)**
        2. 그  MAC 주소로 패킷을 보냄
        - **ARP (Address Resolution Protocol)**
            
            : MAC 주소와 IP주소를 연결하여 통신할 수 있게 하는 일련의 시스템. IP패킷을 보내고 싶은 상대의 MAC주소를 조사할 때 사용
            
            1. **ARP request**
            : IP 주소에 대응된 MAC 주소를 알아내기 위해 같은 네트워크 전체에 패킷 전송(브로드캐스트)
            2. **ARP response**
            : 해당되는 컴퓨터가 자신의 MAC주소를 응답
    - **다른 네트워크에 속한 컴퓨터와 통신**
        1. 기본 게이트웨이로 ARP 요청 후 기본 게이트웨이가 자신의 MAC 주소 응답
        2. 기본 게이트웨이가 다른 네트워크로 전송
        

### 1-4. 패킷

- **데이터를 교환하는 방법**
    1. **회선 교환 방식**
        - 데이터를 교환하는 동안 계속해서 회선을 점유하는 방식
        - 기본적으로 1:1
        - 비효율적
    2. **패킷 교환 방식**
        - 주고 받는 데이터를 ‘패킷’으로 나눠 회선을 공용해서 복수의 통신을 보내는 방식
        - 회선을 점유하지 않음 (한 회선을 여러 패킷이 사용 가능)
- **패킷 구조**
    - **헤더**: 받는 곳, 보내는 곳, 순서 등 저장 ⇒ 도착한 곳에서 데이터 복원 가능
    - **페이로드**: 작게 분할한 데이터
    

---

## 2. IP 주소 구조

### 2-1. IP 주소 분석

- **DHCP (Dynamic Host Configuration Protocol)**
    
    : 라우터에서 IP를 자동으로 할당받는 기술
    
    - **DHCP 흐름**
        1. **DHCP Discover**: DHCP 클라이언트가 DHCP 서버를 찾고자 네트워크 통신을 하는 것
        2. **DHCP Offer**: DHCP 서버가 DHCP 클라이언트에 설정을 제안하는 통신을 하는 것
        3. **DHCP Request**: DHCP 클라이언트가 DHCP서버에 제안된 설정의 세부 사항을 요청하는 통신을 하는 것
        4. **DHCP ACK**: DHCP 서버가 DHCP 클라이언트에 설정의 세부 사항을 지정하는 통신을 하는 것
- **서브넷 마스크 (=넷마스크)**
    
    : IP 주소에서 네트워크부 범위를 나타내는 것
    
    - 1부분은 네트워크부, 0부분은 호스트부를 뜻함

### 2-2. IP 주소의 할당과 관리

- 호스트부를 바꾸어 각 기기에 IP를 할당
- 할당 불가능한 숫자
    - **네트워크 주소**: 호스트부의 시작 숫자 (호스트부가 전부 0, 그 네트워크 자체를 의미)
    - **브로드캐스트 주소:** 마지막 숫자 (호스트부가 전부 1, 네트워크 전체에 통신을 보낼 때 사용)
- **클래스 및 가변 길이 서브넷 마스크**
    - 네트워크부의 길이에 따라 클래스가 나뉨
    - **주요 클래스**
    
    | 클래스 | 1옥텟 | 2옥텟 | 3옥텟 | 4옥텟 |
    | --- | --- | --- | --- | --- |
    | 클래스 A | 11111111 | 00000000 | 00000000 | 00000000 |
    | 클래스 B | 11111111 | 11111111 | 00000000 | 00000000 |
    | 클래스 C | 11111111 | 11111111 | 11111111 | 00000000 |
    - **가변 길이 서브넷 마스크**
        
        : 서브넷 마스크 길이를 변경하여 네트워크 크기를 바꾼 것
        

### 2-3. 데이터가 바르게 전송되는 메커니즘

- **기본 게이트웨이**
    
    : 규정 수신처를 의미하며, 전송할 라우터가 정해져 있지 않은 경우에는 반드시 이곳으로 보냄
    
- **라우팅**
    
    : 라우터가 수행하는 작업
    
- **라우팅 테이블**
    
    : 네트워크로의 통신을 어느 라우터로 전달해야 하는지 기록
    
- **라우터에서 라우터로 전송**
    
    : 라우터도 보낼 곳을 모르는 네트워크와 연결해야 할 경우 보낼 기본 게이트웨이(기본 라우트)가 있음. 기본 라우터로 전송하면 기본 라우터가 다시 전송처를 찾는 식으로 버킷 릴레이를 반복하여 네트워크가 성립됨
    
- **실습 - IP 주소와 MAC 주소 확인**
    
    ```powershell
    > ipconfig /all
    
    Windows IP 구성
    
       호스트 이름 . . . . . . . . : DESKTOP-AIFCNSO
       주 DNS 접미사 . . . . . . . :
       노드 유형 . . . . . . . . . : 혼성
       IP 라우팅 사용. . . . . . . : 아니요
       WINS 프록시 사용. . . . . . : 아니요
    
    무선 LAN 어댑터 Wi-Fi:
    
       연결별 DNS 접미사. . . . :
       설명. . . . . . . . . . . . : Intel(R) Dual Band Wireless-AC 8265
       **물리적 주소 . . . . . . . . : F8-63-3F-1C-38-EC  // MAC주소**
       DHCP 사용 . . . . . . . . . : 예
       자동 구성 사용. . . . . . . : 예
       링크-로컬 IPv6 주소 . . . . : fe80::34a9:8f95:dbb:db37%5(기본 설정)
       **IPv4 주소 . . . . . . . . . : 192.168.0.10(기본 설정)**
       **서브넷 마스크 . . . . . . . : 255.255.255.0**
       임대 시작 날짜. . . . . . . : 2023년 11월 12일 일요일 오후 4:23:09
       임대 만료 날짜. . . . . . . : 2023년 11월 12일 일요일 오후 9:23:07
       **기본 게이트웨이 . . . . . . : 192.168.0.1**
       DHCP 서버 . . . . . . . . . : 192.168.0.1
       DHCPv6 IAID . . . . . . . . : 83387199
       DHCPv6 클라이언트 DUID. . . : 00-01-00-01-2B-0D-42-22-F8-63-3F-1C-38-EC
       DNS 서버. . . . . . . . . . : 180.182.54.1
                                     1.214.68.2
       Tcpip를 통한 NetBIOS. . . . : 사용
    ```
    

---

## 3. 네트워크 프로토콜

### 3-1. 네트워크 계층

- **L2 스위치**
    - MAC 주소에 따라 데이터를 전송하는 것
    - 모든 포트에 같은 데이터를 보내는 리피터와 달리, 목적지 MAC 주소를 기억하므로 해당 포트에만 데이터를 보냄
- **L3 스위치**
    - L2 스위치에 다른 네트워크를 연결하는 기능 추가
    - **라우터와 L3 스위치 차이**
        
        
        |  | 라우터 | L3 스위치 |
        | --- | --- | --- |
        | 회선 종류 | 왠 회선 및 전화 회선, 광회선 등 | 왠 회선 |
        | 보안 | 송수신 일관성 검사, 위조 방지와 같은 패킷 체크 기능 | 패킷 필터 기능 |
- **L4 스위치, L7 스위치**
    - 로드 밸런서라도고 함
    - 로드 밸런싱: 시스템에 대한 요청을 여러 서버에 분산해서 통신량의 균형을 조절하는 기술
    - **L4 스위치 배분 방식**
        1. 라운드 로빈: 분산처에 순서대로 할당
        2. 최소 연결: 분산처 중 가장 커넥션이 적은 곳으로 데이터 분산
    - **L7 스위치 배분 방식**
        - L4 스위치에 응용 계층의 내용까지 분석하여 데이터를 분산
        - 세션을 유지하는 기능을 수행
    

### 3-2. TCP와 UDP

: TCP와 UDP는 IP의 상위인 OSI 참조 모델 4계층에서 동작하는 프로토콜. 3계층에서 동작하는 IP와 5-7 계층에서 동작하는 애플리케이션(HTTP 등)을 중개

- **TCP**
    - 신뢰할 수 있는 통신을 실현하는 기능 구현
    - 데이터 일관성이 중요한 애플리케이션이 사용
    - ex) HTTP
- **UDP**
    - 신뢰성 확보 기능이 없는 대신 TCP보다 속도가 빠름
    - 고속성이나 실시간성을 요구하는 애플리케이션에서 사용
    - ex) IP 전화
- **포트 번호**
    
    : 통신하는 대상 컴퓨터의 애플리케이션을 특정하는 번호
    
    ex) 한 서버에서 웹 서버와 메일 서버를 동시에 실행하는 경우 IP 주소만으로 두 서버를 구분할 수 없으므로 포트 번호를 이용하여 구분
    
    - **종류**
        
        
        | 타입 | 범위 | 개요 |
        | --- | --- | --- |
        | 잘 알려진 포트 번호 | 0~1023 | 애플리케이션(서버 측)에서 사용하는 포트 번호 |
        | 등록된 포트 번호 | 1024~49151 | 잘 알려진 포트 번호에 없는 독자적으로 만들어진 애플리케이션에서 사용하는 포트 번호 |
        | 동적 포트 번호 | 49152~65535 | 애플리케이션(클라이언트 측)에서 사용하는 포트 번호
        출발지 포트 번호 할당 시 사용 |
    - **자주 사용되는 잘 알려진 포트 번호**
        
        
        | 포트 번호 | 프로토콜 이름 | 트랜스포트 프로토콜 | 개요 |
        | --- | --- | --- | --- |
        | 80 | HTTP | TCP | 웹 서버 접속 |
        | 443 | HTTPS | TCP | 웹 서버 접속(SSL/TLS 암호화) |
        | 110 | POP3 | TCP | 메일 박스 읽기 |
        | 25 | SMTP | TCP | 메일 서버 간 이메일 전송 |
        | 22 | SSH | TCP | 컴퓨터에 원격 로그인 |
        | 53 | DNS | UDP | DNS 서버에 질의 |
        | 123 | NTP | TCP | 시간 동기화 |

### 3-3. ICMP (Internet Control Message Protocol)

: TCP/IP가 구현된 컴퓨터 및 네트워크 기기 사이에서 통신 상태를 확인할 때 사용하는 프로토콜.

- OSI 참조 모델 3계층에서 동작하는 프로토콜
- IP와 동일한 계층이지만 IP 위에서 동작 (사실상 TCP/UDP와 동일한 위치)
- 연결 확인에 사용되는 `ping`, `trace` 명령어가 ICMP 프로토콜을 사용하는 프로그램
- TCP/UDP를 거치지 않고 동작하므로 포트 번호가 없음

### 3-4. NAT (Network Address Translation)

: IP 주소를 변환하는 기술. 랜 내에서 사용되는 프라이빗 IP 주소를 글로벌 IP주소로 변환하는 것

- **실습 - 포트 조회**

```powershell
> netstat -n -p tcp

활성 연결

  프로토콜  로컬 주소           외부 주소              상태
  TCP    192.168.0.10:62178     20.198.119.143:443     ESTABLISHED
  TCP    192.168.0.10:62884     211.249.219.27:443     TIME_WAIT
...
```

### 3-5. 프라이빗 IP 주소에 사용할 수 있는 IP 주소

: 아래 세가지 클래스로 정해져 있음. 글로벌 IP 주소로 사용되지 않음

| 클래스 | 주소 |
| --- | --- |
| 클래스 A | 10.0.0.0/8 |
| 클래스 B | 172.16.0.0/12 |
| 클래스 C | 192.168.0.0/16 |

### 3-6. CIDR (Classless Inter-Domain Routing)

: 쉽게 말해 목적지 여러 개를 모은 것

- 라우팅 집약
    
    : 라우팅을 모아서 쓰는 것. 작은 네트워크 세그먼트를 포함하는 큰 네트워크 세그먼트
    

### 3-7. 정적 라우팅과 동적 라우팅

: 라우팅 테이블 정보를 관리하는 방법

- **정적 라우팅**
    - 라우팅 테이블을 수동으로 관리 하는 기술
    - 네트워크 구축/변경 시 사람이 직접 모든 라우팅 테이블을 설정
- **동적 라우팅**
    - 라우터끼리 정기적 또는 필요에 따라 네트워크에 관한 정보를 교환하고 이를 바탕으로 라우팅 테이블을 자동으로 설정하는 방법
    - 동적 라우팅으로 정보를 교환하는 방식을 **라우팅 프로토콜**이라고 함